# üßµ Swift 6 Concurrency ‚Äî –ü–æ–≤–Ω–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç

Swift 6 –ø–æ–≥–ª–∏–±–ª—é—î –º–æ–¥–µ–ª—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—ñ –∑–∞ —Ä–∞—Ö—É–Ω–æ–∫:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è `Sendable`
- –ü—ñ–¥—Å–∏–ª–µ–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ–∫–∏
- –ü–æ–∫—Ä–∞—â–µ–Ω–æ—ó –≤–∑–∞—î–º–æ–¥—ñ—ó `actor`, `@MainActor`, `Task`, `TaskGroup`

---

## üìå –©–æ —Ç–∞–∫–µ Concurrency?

**Concurrency (–æ–¥–Ω–æ—á–∞—Å–Ω—ñ—Å—Ç—å)** ‚Äî —Ü–µ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º–∏ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –∑–∞–¥–∞—á _–ª–æ–≥—ñ—á–Ω–æ_ –æ–¥–Ω–æ—á–∞—Å–Ω–æ.  
Swift —Ä–µ–∞–ª—ñ–∑—É—î concurrency —á–µ—Ä–µ–∑ `async/await`, `Task`, `actor`, `Sendable`.

---

## ‚úÖ async/await

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–æ–∑–≤–æ–ª—è—é—Ç—å –ø–∏—Å–∞—Ç–∏ –∑—Ä–æ–∑—É–º—ñ–ª–∏–π –∫–æ–¥, —è–∫–∏–π –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –Ω–µ–±–ª–æ–∫—É—é—á–µ.

```swift
func fetchUser() async -> User {
    ...
}

Task {
    let user = await fetchUser()
    print(user.name)
}
```

---

## üéØ Task

`Task` –∑–∞–ø—É—Å–∫–∞—î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É –∑–∞–¥–∞—á—É –≤ –Ω–æ–≤–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ:

```swift
Task {
    let data = await fetchData()
}
```

---

## üîπ Detached Task

–ù–µ —É—Å–ø–∞–¥–∫–æ–≤—É—î context (actor/main actor/priority):

```swift
Task.detached {
    await doBackgroundStuff()
}
```

---

## üîÑ TaskGroup

–ó–∞–±–µ–∑–ø–µ—á—É—î –ø–∞—Ä–∞–ª–µ–ª—å–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö –ø—ñ–¥–∑–∞–¥–∞—á —ñ –∑–±—ñ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤:

```swift
await withTaskGroup(of: String.self) { group in
    for url in urls {
        group.addTask {
            return await download(url)
        }
    }

    for await file in group {
        print("Downloaded:", file)
    }
}
```

---

## üß† Sendable

`Sendable` ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª, —è–∫–∏–π —Å–∏–≥–Ω–∞–ª—ñ–∑—É—î, —â–æ —Ç–∏–ø **–±–µ–∑–ø–µ—á–Ω–∏–π –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –º—ñ–∂ –ø–æ—Ç–æ–∫–∞–º–∏**.

```swift
struct Person: Sendable {
    let name: String
}
```

> Swift –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–±–∏—Ç—å `Sendable` –¥–ª—è struct/enum –±–µ–∑ reference type.

–Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à reference —Ç–∏–ø–∏ ‚Äî –¥–æ–¥–∞–≤–∞–π `@unchecked Sendable` _—Ç—ñ–ª—å–∫–∏ –∑ –ø–æ–≤–Ω–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø–æ—Ç–æ–∫—ñ–≤_.

```swift
final class Cache: @unchecked Sendable {
    private var store: [String: Any] = [:]
}
```

---

## üé≠ Actor

`actor` ‚Äî —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∞ –æ–±–ª–∞—Å—Ç—å, —â–æ –≥–∞—Ä–∞–Ω—Ç—É—î –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ —Å–≤–æ—ó—Ö –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π.

```swift
actor BankAccount {
    private var balance = 0

    func deposit(_ amount: Int) {
        balance += amount
    }

    func getBalance() -> Int {
        balance
    }
}
```

> –í—Å—ñ –≤–∏–∫–ª–∏–∫–∏ –º–µ—Ç–æ–¥—ñ–≤ `actor` –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ `await`.

---

## üõ°Ô∏è @MainActor

–ü–æ–∑–Ω–∞—á–∞—î, —â–æ —Ñ—É–Ω–∫—Ü—ñ—è/–∫–ª–∞—Å **–º–∞—î –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—å –Ω–∞ –≥–æ–ª–æ–≤–Ω–æ–º—É –ø–æ—Ç–æ—Ü—ñ** (–¥–ª—è UI-–æ–Ω–æ–≤–ª–µ–Ω—å):

```swift
@MainActor
class ViewModel {
    func show() {
        print("Hello from main thread")
    }
}
```

–ú–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –∑ –±—É–¥—å-—è–∫–æ–≥–æ –ø–æ—Ç–æ–∫—É, —ñ Swift –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–º–∫–Ω–µ—Ç—å—Å—è –Ω–∞ –≥–æ–ª–æ–≤–Ω–∏–π.

---

## üß© nonisolated

`nonisolated` –¥–æ–∑–≤–æ–ª—è—î –æ–≥–æ–ª–æ—Å–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é —É `actor`, —è–∫–∞ _–Ω–µ_ –ø–æ—Ç—Ä–µ–±—É—î `await`.

```swift
actor Logger {
    nonisolated func staticInfo() -> String {
        "Version 1.0"
    }
}
```

---

## üõë Error Handling –≤ async

```swift
func fetch() async throws -> Data { ... }

Task {
    do {
        let data = try await fetch()
    } catch {
        print("Error:", error)
    }
}
```

---

## üß™ –î–æ–¥–∞—Ç–∫–æ–≤–æ

- `Task.sleep(nanoseconds:)` ‚Äî –∑–∞—Ç—Ä–∏–º–∫–∞ –±–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
- `await Task.yield()` ‚Äî –≤—ñ–¥–¥–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —ñ–Ω—à–∏–º —Ç–∞—Å–∫–∞–º
- `Task.checkCancellation()` ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –∑–∞–¥–∞—á–∞ —Å–∫–∞—Å–æ–≤–∞–Ω–∞

---

## üìö –î–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏

| –°–∏—Ç—É–∞—Ü—ñ—è                   | –†—ñ—à–µ–Ω–Ω—è           |
|----------------------------|-------------------|
| –ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–π –¥–æ—Å—Ç—É–ø     | `actor`, `Sendable` |
| UI-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è               | `@MainActor`      |
| –ü–∞—Ä–∞–ª–µ–ª—å–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è    | `TaskGroup`       |
| –§–æ–Ω–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó            | `Task.detached`   |

---

_–ü–∞–º º—è—Ç–∞–π_: Swift Concurrency ‚Äî —Ü–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ async/await, –∞ **—Ü—ñ–ª–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ race condition**, —ñ —Ç–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî **–¥–æ–ø–æ–º–æ–≥—Ç–∏ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä—É –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å –ø–æ—Ç–æ–∫—ñ–≤**.
