
# üß† –ì–ª–∏–±–æ–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç: Swift 6 Concurrency

## 1. –©–æ —Ç–∞–∫–µ Concurrency?

Concurrency ‚Äî —Ü–µ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –∑–∞–¥–∞—á –ª–æ–≥—ñ—á–Ω–æ –æ–¥–Ω–æ—á–∞—Å–Ω–æ.  
Swift —Ä–µ–∞–ª—ñ–∑—É—î —ó—ó —á–µ—Ä–µ–∑ `async/await`, `Task`, `actor`, `Sendable`.

–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è:

| –ú–æ–¥–µ–ª—å       | –Ø–∫ –≤–∏–≥–ª—è–¥–∞—î      | –ù–µ–¥–æ–ª—ñ–∫–∏            |
|--------------|------------------|----------------------|
| GCD          | `DispatchQueue`  | race condition       |
| Operation    | `OperationQueue` | —Å–∫–ª–∞–¥–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è |
| Swift Concurrency | `async/await` | —Å—Ç–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–µ–∑–ø–µ–∫–∏ |

## 2. async / await

```swift
func fetchUser() async -> User { ... }

Task {
    let user = await fetchUser()
}
```

## 3. Task

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–¥–∞—á—ñ:

```swift
Task {
    await loadData()
}
```

### Detached Task:

```swift
Task.detached(priority: .background) {
    await backgroundOperation()
}
```

## 4. –§—É–Ω–∫—Ü—ñ—ó Task

| –§—É–Ω–∫—Ü—ñ—è | –û–ø–∏—Å |
|--------|------|
| `Task {}` | –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–¥–∞—á—É |
| `Task.detached {}` | –ù–µ–∑–∞–ª–µ–∂–Ω–∞ –∑–∞–¥–∞—á–∞ |
| `Task.sleep(nanoseconds:)` | –ó–∞—Ç—Ä–∏–º–∫–∞ |
| `Task.checkCancellation()` | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è |
| `Task.isCancelled` | –ß–∏ —Å–∫–∞—Å–æ–≤–∞–Ω–∞ –∑–∞–¥–∞—á–∞ |
| `Task.cancel()` | –°–∫–∞—Å—É–≤–∞—Ç–∏ –∑–∞–¥–∞—á—É |
| `Task.yield()` | –ü–µ—Ä–µ–¥–∞—Ç–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è |
| `Task.currentPriority` | –ü–æ—Ç–æ—á–Ω–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç |

## 5. TaskGroup

```swift
await withTaskGroup(of: Int.self) { group in
    for i in 1...3 {
        group.addTask {
            return i * i
        }
    }
    for await result in group {
        print(result)
    }
}
```

## 6. Sendable

```swift
struct User: Sendable {
    let id: Int
}
```

- –ü—Ä–æ—Ç–æ–∫–æ–ª, —â–æ –≥–∞—Ä–∞–Ω—Ç—É—î –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ–∫—É –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á—ñ

## 7. Actor

```swift
actor Counter {
    private var value = 0

    func inc() { value += 1 }
    func get() -> Int { value }
}
```

- –Ü–∑–æ–ª—å–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ `await`

## 8. @MainActor

```swift
@MainActor
class ViewModel {
    func updateUI() { ... }
}
```

- –ó–∞–±–µ–∑–ø–µ—á—É—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–∞ –≥–æ–ª–æ–≤–Ω–æ–º—É –ø–æ—Ç–æ—Ü—ñ

## 9. nonisolated

```swift
actor Logger {
    nonisolated func version() -> String { "v1.0" }
}
```

- –î–æ–∑–≤–æ–ª—è—î –º–µ—Ç–æ–¥–∞–º –Ω–µ –±—É—Ç–∏ —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–º–∏, —è–∫—â–æ –Ω–µ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø—É –¥–æ —Å—Ç–∞–Ω—É

## 10. Error Handling

```swift
func load() async throws -> Data { ... }

Task {
    do {
        let data = try await load()
    } catch {
        print(error)
    }
}
```

## 11. –¢–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏

- ‚ùå –ó–∞–±—É–ª–∏ `await` –ø—Ä–∏ async-–≤–∏–∫–ª–∏–∫—É
- ‚ùå Race condition –ø—Ä–∏ –¥–æ—Å—Ç—É–ø—ñ –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å—É
- ‚ùå –ù–µ–æ–±“ë—Ä—É–Ω—Ç–æ–≤–∞–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `Task.detached`

## 12. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π `actor` –¥–ª—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏—Ö —Ç–∏–ø—ñ–≤
- –ü–æ–∑–Ω–∞—á–∞–π —Ç–∏–ø–∏ `Sendable` –¥–ª—è Task/actor
- –î–ª—è UI ‚Äî –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ `@MainActor`



---

## üí• Edge Cases (—Ç–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏)

### ‚ùå –ó–∞–±—É–ª–∏ `await`
```swift
func getData() async -> String { "Done" }

Task {
    let data = getData() // ‚ùå –ü–æ–º–∏–ª–∫–∞: –ø–æ—Ç—Ä—ñ–±–Ω–æ `await`
}
```

### ‚ùå Race condition —á–µ—Ä–µ–∑ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–æ—ó
```swift
var count = 0

Task {
    for _ in 0..<10 {
        count += 1 // ‚ùóÔ∏è –ú–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ race condition
    }
}
```

‚úÖ –†—ñ—à–µ–Ω–Ω—è ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π `actor`.

---

## üß† –î–æ Swift Concurrency

| –ú–µ—Ö–∞–Ω—ñ–∑–º        | –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞         |
|----------------|------------------------|
| `DispatchQueue`| –í—Ä—É—á–Ω—É, –º–æ–∂–ª–∏–≤—ñ –±–∞–≥–∏   |
| `OperationQueue`| –ê–±—Å—Ç—Ä–∞–∫—Ü—ñ—è + –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ |
| `Swift Concurrency` | –ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ–∫–∞ + —Ç–∏–ø–æ–±–µ–∑–ø–µ–∫–∞ |

### üìå –ü—Ä–∏–∫–ª–∞–¥ —ñ–∑ GCD:
```swift
DispatchQueue.global().async {
    load()
}
```

### üìå –£ Swift 6:
```swift
Task {
    await load()
}
```

Swift –≥–∞—Ä–∞–Ω—Ç—É—î –ø—Ä–∞–≤–∏–ª—å–Ω—É —á–µ—Ä–≥–æ–≤—ñ—Å—Ç—å —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É `Sendable`.

---

## üìä –°—Ö–µ–º–∞ –ø–æ—Ç–æ–∫—ñ–≤

- `Task {}` ‚Üí –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤ default-–ø—É–ª—ñ
- `Task.detached {}` ‚Üí –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É, —Ñ–æ–Ω–æ–≤–æ
- `@MainActor` ‚Üí –≥–∞—Ä–∞–Ω—Ç—É—î –≥–æ–ª–æ–≤–Ω–∏–π –ø–æ—Ç—ñ–∫

```plaintext
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   Task      ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚ñº                                  ‚ñº
   –ù–∞—Å–ª—ñ–¥—É—î –∫–æ–Ω—Ç–µ–∫—Å—Ç             Detached (—ñ–∑–æ–ª—å–æ–≤–∞–Ω–æ)
      (actor, –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç)             (main –Ω–µ –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ)
```

---

## üß™ –¢–µ—Å—Ç–∏ —Å–∞–º–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

1. –ö–æ–ª–∏ –≤–∞—Ä—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `actor`, –∞ –∫–æ–ª–∏ `Sendable`?
2. –Ø–∫–∞ —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ `Task` —ñ `Task.detached`?
3. –ß–∏–º `withTaskGroup` –∫—Ä–∞—â–∏–π –∑–∞ —Ü–∏–∫–ª –∑ `await`?
4. –ß–æ–º—É –¥–æ—Å—Ç—É–ø –¥–æ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –≤ `actor` –ø–æ—Ç—Ä–µ–±—É—î `await`?
5. –Ø–∫ –ø—Ä–∞—Ü—é—î `@MainActor` —É ViewModel?

---

## ‚ö†Ô∏è –ê–Ω—Ç–∏–ø–∞—Ç–µ—Ä–Ω–∏

### ‚ùå –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –±–µ–∑ –∑–∞—Ö–∏—Å—Ç—É
```swift
var cache = [String: Any]()

Task {
    cache["key"] = "value" // race condition
}
```

‚úÖ –†—ñ—à–µ–Ω–Ω—è: `actor`.

### ‚ùå –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `DispatchQueue` —Ä–∞–∑–æ–º –∑ `Task`
```swift
DispatchQueue.main.async {
    Task {
        await doSomething()
    }
}
```
–ù–µ–º–∞—î —Å–µ–Ω—Å—É ‚Äî –ø—Ä–æ—Å—Ç–æ `@MainActor` –∞–±–æ `Task {}` –¥–æ—Å—Ç–∞—Ç–Ω—å–æ.

---

üß† –í–∏—Å–Ω–æ–≤–æ–∫: Swift 6 –ø—Ä–æ–ø–æ–Ω—É—î **–ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—É –º–æ–¥–µ–ª—å, —â–æ –∑–∞—Ö–∏—â–∞—î —Ç–µ–±–µ –Ω–∞ —Ä—ñ–≤–Ω—ñ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä–∞**. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî **–¥–æ–ø–æ–º–æ–≥—Ç–∏ –π–æ–º—É –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ**.

---

## üß∑ @TaskLocal ‚Äî –ª–æ–∫–∞–ª—å–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–¥–∞—á—ñ

`@TaskLocal` ‚Äî —Ü–µ —Å–ø–æ—Å—ñ–± –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è, –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–µ –¥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É **–æ–¥–Ω—ñ—î—ó Task**, —è–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–µ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–µ–Ω–∏—Ö Task (—è–∫ ThreadLocal —É Java).

### üîπ –û–≥–æ–ª–æ—à–µ–Ω–Ω—è:

```swift
enum Session {
    @TaskLocal static var userID: String?
}
```

> ‚ö†Ô∏è `@TaskLocal` –º–æ–∂–Ω–∞ –æ–≥–æ–ª–æ—à—É–≤–∞—Ç–∏ –ª–∏—à–µ –¥–ª—è static –∑–º—ñ–Ω–Ω–∏—Ö

---

### üîπ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

```swift
Task {
    Session.userID = "abc-123"

    await performRequest()
}

func performRequest() async {
    print("User ID: \(Session.userID ?? "none")")
}
```

üìå –ó–Ω–∞—á–µ–Ω–Ω—è `Session.userID` –±—É–¥–µ `"abc-123"` –ª–∏—à–µ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ü—ñ—î—ó `Task`

---

### üß™ –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:

- ‚úÖ –ó–Ω–∞—á–µ–Ω–Ω—è –≤–∏–¥–∏–º–µ **–≤—Å—ñ–º –≤–∫–ª–∞–¥–µ–Ω–∏–º Task** (—è–∫ "—Å–ø–∞–¥–∫–æ—î–º—Ü—ñ")
- ‚ùå `Task.detached` –Ω–µ —É—Å–ø–∞–¥–∫–æ–≤—É—î –∑–Ω–∞—á–µ–Ω–Ω—è
- ‚ùó –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö, `tracing`, `auth context`

---

### üß® –ß–æ–º—É —Ü–µ –Ω–µ –≥–ª–æ–±–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞?

–ë–æ —Ü–µ **—ñ–∑–æ–ª—å–æ–≤–∞–Ω–µ –¥–æ Task**:
- –ù–µ —Å—Ç–≤–æ—Ä—é—î race condition
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–æ
- –ù–µ –∑–º—ñ—à—É—î—Ç—å—Å—è –º—ñ–∂ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏

---

### üß© –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:

| –°—Ü–µ–Ω–∞—Ä—ñ–π                    | –ü—Ä–∏–∫–ª–∞–¥                      |
|-----------------------------|------------------------------|
| –¢—Ä–µ–∫–∏–Ω–≥ auth/session        | `Session.userID`             |
| Debug/tracing               | `Log.traceID`                |
| –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è API –≤–∏–∫–ª–∏–∫—ñ–≤   | `API.requestID`              |

---


---

# üöÄ Advanced Swift Concurrency (—Ä–æ–∑—à–∏—Ä–µ–Ω–∞ —Ç–µ–æ—Ä—ñ—è)

## üîπ async let ‚Äî –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è

```swift
async let user = fetchUser()
async let posts = fetchPosts()

let result = await (user, posts)
```

- üî∏ –ö—Ä–∞—â–µ –∑–∞ `TaskGroup` –¥–ª—è –Ω–µ–≤–µ–ª–∏–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –Ω–µ–∑–∞–ª–µ–∂–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤
- ‚ùå –ü–æ–º–∏–ª–∫–∏ –Ω–µ –ª–æ–≤–ª—è—Ç—å—Å—è –æ–∫—Ä–µ–º–æ ‚Äî —è–∫—â–æ –æ–¥–∏–Ω –ø–∞–¥–∞—î, –ø–∞–¥–∞—é—Ç—å –≤—Å—ñ

---

## üîπ withThrowingTaskGroup

```swift
await withThrowingTaskGroup(of: Int.self) { group in
    group.addTask { throw SomeError() }
    for try await result in group {
        print(result)
    }
}
```

- –î–æ–∑–≤–æ–ª—è—î –¥–æ–¥–∞–≤–∞—Ç–∏ –∑–∞–¥–∞—á—ñ, —è–∫—ñ –º–æ–∂—É—Ç—å –∫–∏–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫—É
- `try await` ‚Äî –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ

---

## üîπ TaskCancellationHandler

```swift
try await Task.withCancellationHandler(
    operation: {
        try await longOp()
    },
    onCancel: {
        cleanup()
    }
)
```

- –î–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–¥ –ø—Ä–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—ñ
- –î—É–∂–µ –∫–æ—Ä–∏—Å–Ω–æ —É networking

---

## üîπ MainActor.run

```swift
Task.detached {
    await MainActor.run {
        label.text = "Updated"
    }
}
```

- –í–∏–∫–ª–∏–∫–∞—î –±–ª–æ–∫ **–Ω–∞ –≥–æ–ª–æ–≤–Ω–æ–º—É –ø–æ—Ç–æ—Ü—ñ** –Ω–∞–≤—ñ—Ç—å –∑ —Ñ–æ–Ω—É

---

## üîπ nonisolated(unsafe)

```swift
actor Logger {
    nonisolated(unsafe) func log(_ msg: String) {
        print(msg)
    }
}
```

- ‚ùó –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π **–¥—É–∂–µ –æ–±–µ—Ä–µ–∂–Ω–æ**
- –î–∞—î –¥–æ—Å—Ç—É–ø –±–µ–∑ —ñ–∑–æ–ª—è—Ü—ñ—ó ‚Üí –º–æ–∂–ª–∏–≤—ñ race condition

---

## üîπ @preconcurrency

```swift
@preconcurrency
class LegacyClass { ... }
```

- –í–∏–º–∏–∫–∞—î –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É concurrency –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑ legacy-–∫–æ–¥–æ–º

---

## üîπ @unchecked Sendable

```swift
final class UnsafeWrapper: @unchecked Sendable {
    var buffer: UnsafeMutableRawPointer
}
```

- –ü—Ä–∏–º—É—Å–æ–≤–æ –≤–≤–∞–∂–∞—î —Ç–∏–ø `Sendable`, –∞–ª–µ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –±—ñ–ª—å—à–µ –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î

---

## üîπ Custom GlobalActor

```swift
@globalActor
struct AnalyticsActor {
    static let shared = ActorInstance()
}

@AnalyticsActor
func trackEvent() { ... }
```

- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–æ—ó "–≥–ª–æ–±–∞–ª—å–Ω–æ—ó" —á–µ—Ä–≥–∏/—ñ–∑–æ–ª—è—Ü—ñ—ó
- –°—Ö–æ–∂–µ –Ω–∞ `@MainActor`, –∞–ª–µ –¥–ª—è —Å–≤–æ—ó—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤

---

